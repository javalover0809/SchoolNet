<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js"></script>
<!---->
    <style type="text/css">
        html,body {
            height: 100%;
            width:100%
        }
    </style>
</head>
<body>
<div style="background: white; height:100%; width: 100%;">

        <div  id="content_app">
                <p v-for = "private_message in infos" >
                    <br>发送时间&nbsp{{ private_message.message_create_time }}</br>
                    {{ private_message.username }}发送给:{{private_message.private_message_friend_name}}：{{private_message.to_message_content}}
                </p>
        </div>
        <div style="background: white; height:20%; width: 100%; position:fixed;bottom:0;">
            <form method="get" action="publish_private_message">
                <div  id="content_apps">
                    <input id="get_friend_name" type="textarea" name="friend_name" v-model="friend_name" style="display:none">
                    <textarea rows="XX" cols="XX"  style="background: white; height:20%; width: 100%; position:fixed;bottom:10;" type="textarea" name="to_message_content" placeholder="私聊..."></textarea>
                    <input style="background: blue; height:5%; width: 100%; position:fixed;bottom:0;" type="submit" name="button" align="middle" value="发送"/>
                </div>
            </form>
</div>
</body>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<script>






new Vue({
  el: '#content_app',
  data () {
    return {
    infos:  null,
    friend_name: null
    }
  },
  mounted () {
     this.submit()
  },
  methods: {
   submit(){

     let friend_name = this.getQueryVariable("friend_name")
     axios.get('/messages?friend_name='+friend_name)
      .then(response => (
       this.infos = response.data
      ))
      .catch(function (error) { // 请求失败处理
        console.log(error);
      });
    },

    getQueryVariable: function (variable){
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
    }
  }

})

  new Vue({
  el: '#content_apps',
  data () {
    return {
    friend_name:  null
    }
  },


mounted () {
     this.submit()
  },
  methods: {
   submit(){
    let private_message_friend_name = this.getQueryVariable("friend_name")
    axios.get('/messages_send_to?private_message_friend_name='+private_message_friend_name)
      .then(response => (
       this.friend_name = response.data
      ))
      .catch(function (error) { // 请求失败处理
        console.log(error);
      });

    },

    getQueryVariable: function (variable){
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
    }
  }

})



</script>
</html>